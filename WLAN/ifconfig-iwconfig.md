
# ifconfig
> ifconfig - configure a network interface  

1. 执行 `ifconfig -a` 命令可列举显示所有已驱动激活的网络接口状态。

2. 执行 `ifconfig` 命令可列举显示最近活跃的网络接口状态：

```Shell
pi@raspberrypi:~$ ifconfig
eth0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        ether b8:27:eb:15:21:7c  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1  (Local Loopback)
        RX packets 9  bytes 524 (524.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 9  bytes 524 (524.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

其中 `eth0` 为 Raspberry Pi B3 的 Ethernet 10/100 LAN Port。*eth* 为 Ethernet 的缩写，*0* 为编号，eth0这个驱动里的 `name unit` 标识代表第一块以太网卡。  
如果启用了无线网卡(WiFi)，则会多出 `wlan0` 接口。如果通过 USB 连接了第二块无线网卡，则会顺序命名为 `wlan1`,etc。

3. 调用 `ifconfig wlan0` 命令可查看无线网络接口 wlan0 的连接状态：

```Shell
pi@raspberrypi:~$ ifconfig wlan0
wlan0: flags=4098<BROADCAST,MULTICAST>  mtu 1500
        ether b8:27:eb:40:74:29  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

## up | down
`ifconfig wlan0 down`：禁用(shutdown) wlan0。  
`ifconfig wlan0 up`：启用(activate) wlan0，可指定 IP，如 `ifconfig wlan0 up 192.168.1.111`。  

以下命令分别指定以太网卡硬件 MAC 地址（hw ether）、网络掩码（netmask）、广播地址（broadcast）等复合配置参数。

```Shell
ifconfig eth1 192.168.1.252 hw ether 00:11:00:00:11:11 netmask 255.255.255.0 broadcast 192.168.1.255 up
```

## resolv
可查看 `/etc/resolv.conf` 中的 DNS 服务器列表：

```Shell
pi@raspberrypi:~$ cat /etc/resolv.conf
# Generated by resolvconf
search 192.168.1.1
nameserver 192.168.1.1
nameserver 8.8.8.8
nameserver 114.114.114.114
```

# iwconfig
> iwconfig - configure a wireless network interface  

linux 下的 iwconfig 命令类似 ifconfig，专门用于查看、配置、诊断无线网络接口。

执行 `iwconfig` 命令可列举显示无线网络接口状态。

以下为无线网卡 `wlan0` 尚未连接时的无线接口状态：

```Shell
pi@raspberrypi:~$ iwconfig
eth0      no wireless extensions.

lo        no wireless extensions.

wlan0     IEEE 802.11  ESSID:off/any  
          Mode:Managed  Access Point: Not-Associated   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:on
```

以下为无线网卡 `wlan0` 已连接到 WiFi（ESSID:"HiWiFi"）时的无线接口状态：

```Shell
pi@raspberrypi:~$ iwconfig
eth0      no wireless extensions.

lo        no wireless extensions.

wlan0     IEEE 802.11  ESSID:"HiWiFi"  
          Mode:Managed  Frequency:2.412 GHz  Access Point: AA:BB:CC:DD:EE:FF   
          Bit Rate=13 Mb/s   Tx-Power=31 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:on
          Link Quality=38/70  Signal level=-72 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:31  Invalid misc:0   Missed beacon:0
```

同 ifconfig，执行 `iwconfig wlan0` 可指定查看无线网卡 wlan0 的接口状态信息。

## iwlist
iwlist - Get more detailed wireless information from a wireless interface

执行 `sudo iwlist wlan0 scan` 命令，可查看无线网卡扫描到的 WiFi 接入点（Access Point）列表。

以下为 wlan0 尚未开启连接时的提示信息：

```Shell
pi@raspberrypi:~$ sudo iwlist wlan0 scan
wlan0     Interface doesn't support scanning : Network is down
```

以下为 wlan0 开启扫描到的 WiFi Access Point 列表，扫描到附近的 9 个 WiFi 热点（Cell 01~Cell 09）。  
以下只截取自家无线路由 Cell 01（ESSID:"HiWiFi"）的无线信道信息：

```Shell
pi@raspberrypi:~$ iwlist wlan0 scan                                                             
wlan0     Scan completed :
          Cell 01 - Address: AA:BB:CC:DD:EE:FF
                    Channel:1
                    Frequency:2.412 GHz (Channel 1)
                    Quality=43/70  Signal level=-67 dBm  
                    Encryption key:on
                    ESSID:"HiWiFi"
                    Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 6 Mb/s
                              9 Mb/s; 12 Mb/s; 18 Mb/s
                    Bit Rates:24 Mb/s; 36 Mb/s; 48 Mb/s; 54 Mb/s
                    Mode:Master
                    Extra:tsf=0000000000000000
                    Extra: Last beacon: 27590ms ago
                    IE: Unknown: 0006486957694669
                    IE: Unknown: 010882848B960C121824
                    IE: Unknown: 030101
                    IE: Unknown: 05050001000002
                    IE: Unknown: 0706434E20010D20
                    IE: Unknown: 2A0102
                    IE: IEEE 802.11i/WPA2 Version 1
                        Group Cipher : CCMP
                        Pairwise Ciphers (1) : CCMP
                        Authentication Suites (1) : PSK
                    IE: Unknown: 32043048606C
                    IE: Unknown: 2D1A6E101BFFFFFF0000000000000000008000000000000000000000
                    IE: Unknown: 3D1601050500000000000000000000000000000000000000
                    IE: WPA Version 1
                        Group Cipher : CCMP
                        Pairwise Ciphers (1) : CCMP
                        Authentication Suites (1) : PSK
                    IE: Unknown: DD180050F2020101010003A4000027A4000042435E0062322F00
                    IE: Unknown: DD0900037F01010000FF7F
```

- ESSID:"HiWiFi" —— WiFi 热点名称；  
- Encryption key:on —— WiFi 无线加密开启；  
- Authentication Suites: WPA2-PSK —— WiFi 无线加密方式。  

## Connect to Wi-Fi
如果手头有现成的键鼠屏连接进入 Raspberry Pi 3B 图形用户界面（GUI），开启 WiFi 并选择连接到指定 WiFi。如果 WiFi 配置了无线网络访问密码，输入无线路由中预设的密码，即可连接上无线网络。

如果无法进入 GUI，也可通过 linux 的无线配置命令行工具包 iwconfig 来配置连接无线网络。  
若自家无线路由 Cell 01（ESSID:"HiWiFi"）未设置无线安全连接密码，输入以下命令即可指定 wlan0 连接到该网络：

```Shell
iwconfig wlan0 essid "HiWiFi"
```

如果无线网络是 WEP 加密的，密码是 12345678，那么可追加 key 选项指定密码：

```Shell
iwconfig wlan0 essid "HiWiFi" key s:12345678
```

> s 指定 ASCII 文本格式密码。

若无线连接认证成功，则输入 `ifconfig wlan0` 或 `iwconfig wlan0` 可看到 WiFi 无线连接的各项状态参数。

如果无线网络的加密方式是 WPA(2)-PSK，不能使用 [`iwconfig wlan0 key xxx`](http://bbs.csdn.net/topics/390212444) 命令连接，得使用 wpa_supplicant 配置方式。

## wpa_supplicant
- **`wpa_supplicant`**  - Wi-Fi Protected Access client and IEEE 802.1X supplicant  
	> the program that directly interacts with the network interface.  
- **`wpa_cli`**  is a text-based *frontend* program for interacting with wpa_supplicant  
	> the client program that provides a high-level interface  to  the functionality of the daemon.  
- **`wpa_passphrase`** - Generate a WPA PSK from an ASCII passphrase for a SSID  
	> a  utility  needed  to  construct `wpa_supplicant.conf` files that include encrypted passwords.  
- `wpa_supplicant.conf` - the  configuration  file  describing  all networks that the user wants the computer to connect to.  

正常情况下，raspbian 会将连接成功的 WiFi 信息记录到 `/etc/wpa_supplicant/wpa_supplicant.conf` 文件中，作为预选网络（Prefered Known Networks），下次开机会自动按顺序尝试连接预选网络（will be joined automatically）。

```Shell
pi@raspberrypi:~$ sudo cat /etc/wpa_supplicant/wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=CN

network={
        ssid="HiWiFi"
        psk="12345678"
        key_mgmt=WPA-PSK
}
```

以上 HiWiFi 连接配置信息中，psk 为可见明文（ASCII Plain Text）。为安全起见，最好按照 wpa_passphrase 语法生成加密存储的密码串。

wpa_passphrase 配置语法（SYNOPSIS）很简单，后接 WiFi 的名称（ESSID）和密码即可：`wpa_passphrase [ ssid ] [ passphrase ]`。

以下生成自家无线路由 Cell 01（ESSID:"HiWiFi"）的 network 配置信息块：

```Shell
pi@raspberrypi:~$ wpa_passphrase "HiWiFi" "12345678"
network={
        ssid="HiWiFi"
        #psk="12345678"
        psk=301990d334fdcf6b2d76f10a862a604e5797b8e94c0e96efd222fbc4f3b279c1
}
```

可使用十六进制加密的密码串替换掉 `/etc/wpa_supplicant/wpa_supplicant.conf` 中的明文 psk 字段。

如果有其他备用无线网络连接，可按此方式生成其他无线网络接入点的 network 配置信息块，将其添加到 `/etc/wpa_supplicant/wpa_supplicant.conf` 中。开机启动时，将会自动按顺序尝试连接预配置的网络。也可通过配置 priority 字段来指定连接顺序优先级，priority=0 为第一优先级，按自然数依次降序。

---

如果刚安装好 raspbian 系统，手头没有现成的键鼠屏连接进入 Raspberry Pi 3B 图形用户界面，如何使 RPi 3B 开机启动连接无线网络呢？  

1. 先登入自家无线路由器配置后台，查看无线设置信息，包括 WiFi 名称、加密方式及预设密码。  
	> TP-LINK [路由器后台管理](http://service.tp-link.com.cn/detail_article_298.html) Web 服务器的本地域名为 `tplogin.cn`，在浏览器输入`tplogin.cn` 或预留 IP 即可访问管理页面。[经典式路由器](http://www.tp-link.com.cn/product_list_300-150wireless.html)的管理地址为 `192.168.1.1`；[便携式路由器](http://www.tp-link.com.cn/product_list_potablewireless.html)的管理地址为 `192.168.1.253`。  
2. 按照 wpa_passphrase 语法生成 netwok 配置信息块（注意删除 `#psk="12345678"`），添加到  `wpa_supplicant.conf` 文件中，重启即可自动连接。  

	- 如果串口已经配置连接正常，可以通过串口连接登录 RPi 3B 的命令行控制台，修改（新建）  `/etc/wpa_supplicant/wpa_supplicant.conf` 文件，添加 WiFi 连接配置信息，重启即会自动连接到 `wpa_supplicant.conf` 中预配的 WiFi。  
	- 如果尚未配置串口，可以将 microSD 卡从 RPi 取出，重新放入读卡器插入 mac USB 口。此时，macOS 会自动加载 SD 卡，在 finder 中可进入 MS-DOS FAT32 格式的 boot 文件夹。修改（新建）  [`/boot/wpa_supplicant.conf`](http://shumeipai.nxez.com/2017/09/13/raspberry-pi-network-configuration-before-boot.html?variant=zh-cn) 文件，添加 WiFi 连接配置信息，重新将 SD 卡插入 Raspberry Pi 3B，上电重启即可自动连接到  `wpa_supplicant.conf` 中预配的 WiFi。  

可输入 `ifconfig wlan0`、`iwconfig wlan0` 或 `wpa_cli -iwlan0 status` 查看 WiFi 无线连接状态参数，确认无线连接是否成功。

> Apple Configurator: [About the Auto Join and Per-Connection Password Wi-Fi profile settings](https://support.apple.com/en-us/HT202343)  
> Apple Configurator: [How to Create an iOS Configuration Profile and Alter Hidden Settings](https://www.howtogeek.com/253325/how-to-create-an-ios-configuration-profile-and-alter-hidden-settings/)  
> iOS 通过 [Configuration Profiles](http://nshipster.com/configuration-profiles/) [配置一键连接](http://blog.csdn.net/toto18369905359/article/details/52622462)  
> MSDN: [Wi-Fi Profiles in Configuration Manager](https://technet.microsoft.com/en-us/library/dn261221.aspx) / Native Wifi Reference > [Profile XML Schema](https://msdn.microsoft.com/en-us/library/windows/desktop/ms707341(v=vs.85).aspx#)  
> [Nicomsoft WiFi-Manager SDK](https://www.nicomsoft.com/products/wifi-manager/download/)  

## references

> [linux下通过 ifconfig](http://blog.csdn.net/cuiyifang/article/details/8166977) [修改 IP、MAC、netmask、gateway 等网络参数](http://blog.csdn.net/xiaoshun123/article/details/5683289)  
> [Wireless network configuration](https://wiki.archlinux.org/index.php/Wireless_network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)) @archlinux  
> [Setting WiFi up via the command line](https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md) @raspberrypi  
> [linux下的iwpriv（iwlist、iwconfig）的简单应用](http://blog.csdn.net/liangyamin/article/details/7209761)  
> [无线网卡的查看与配置——iw，iwconfig，ethtool](http://blog.163.com/seven_7_one/blog/static/162606412201531852132662/)  
> [iwconfig 的基本用法](http://blog.csdn.net/sukhoi27smk/article/details/46493425) / [iwconfig & wpa_supplicant](http://blog.csdn.net/jacobywu/article/details/7366080)  
> [wpa_supplicant.conf](http://blog.csdn.net/qq_22716879/article/details/51416322)  [配置无线网络](http://www.cnblogs.com/lidabo/p/4866265.html)  
> [Android wpa_supplicant源码分析--conf配置文件](http://blog.csdn.net/cuijiyue/article/details/51428835)  
